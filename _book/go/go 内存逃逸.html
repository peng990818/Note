
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>内存逃逸 · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="go闭包.html" />
    
    
    <link rel="prev" href="./" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="./">
            
                <a href="./">
            
                    
                    Go
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="1.2.1" data-path="go 内存逃逸.html">
            
                <a href="go 内存逃逸.html">
            
                    
                    内存逃逸
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="go闭包.html">
            
                <a href="go闭包.html">
            
                    
                    闭包
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="go embed.html">
            
                <a href="go embed.html">
            
                    
                    embed
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="编译指令.html">
            
                <a href="编译指令.html">
            
                    
                    编译指令
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >内存逃逸</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="&#x5185;&#x5B58;&#x9003;&#x9038;">&#x5185;&#x5B58;&#x9003;&#x9038;</h1>
<h3 id="&#x4E00;&#x3001;&#x6982;&#x5FF5;">&#x4E00;&#x3001;&#x6982;&#x5FF5;</h3>
<p>go&#x4E2D;&#xFF0C;&#x5806;&#x5185;&#x5B58;&#x662F;&#x901A;&#x8FC7;&#x5783;&#x573E;&#x56DE;&#x6536;&#x673A;&#x5236;&#x81EA;&#x52A8;&#x7BA1;&#x7406;&#x7684;&#x3002;&#x7F16;&#x8BD1;&#x5668;&#x51B3;&#x5B9A;&#x5185;&#x5B58;&#x5206;&#x914D;&#x4F4D;&#x7F6E;&#x7684;&#x65B9;&#x5F0F;&#x79F0;&#x4E3A;&#x9003;&#x9038;&#x5206;&#x6790;&#x3002;</p>
<p>&#x9003;&#x9038;&#x5206;&#x6790;&#x7531;&#x7F16;&#x8BD1;&#x5668;&#x5B8C;&#x6210;&#xFF0C;&#x4F5C;&#x7528;&#x4E8E;&#x7F16;&#x8BD1;&#x9636;&#x6BB5;&#x3002;</p>
<h3 id="&#x4E8C;&#x3001;&#x9003;&#x9038;&#x7C7B;&#x578B;">&#x4E8C;&#x3001;&#x9003;&#x9038;&#x7C7B;&#x578B;</h3>
<h4 id="1&#x3001;&#x6307;&#x9488;&#x9003;&#x9038;">1&#x3001;&#x6307;&#x9488;&#x9003;&#x9038;</h4>
<p>&#x5728;&#x51FD;&#x6570;&#x4E2D;&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#xFF0C;&#x8FD4;&#x56DE;&#x4E86;&#x8FD9;&#x4E2A;&#x5BF9;&#x8C61;&#x7684;&#x6307;&#x9488;&#xFF0C;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x51FD;&#x6570;&#x867D;&#x7136;&#x9000;&#x51FA;&#x4E86;&#xFF0C;&#x4F46;&#x662F;&#x56E0;&#x4E3A;&#x6307;&#x9488;&#x7684;&#x5B58;&#x5728;&#xFF0C;&#x5BF9;&#x8C61;&#x7684;&#x5185;&#x5B58;&#x4E0D;&#x80FD;&#x968F;&#x7740;&#x51FD;&#x6570;&#x7ED3;&#x675F;&#x800C;&#x56DE;&#x6536;&#xFF0C;&#x56E0;&#x6B64;&#x53EA;&#x80FD;&#x5206;&#x914D;&#x5728;&#x5806;&#x4E0A;&#x3002;</p>
<h4 id="2&#x3001;interface&#x52A8;&#x6001;&#x7C7B;&#x578B;&#x9003;&#x9038;">2&#x3001;interface{}&#x52A8;&#x6001;&#x7C7B;&#x578B;&#x9003;&#x9038;</h4>
<p>&#x5728;go&#x8BED;&#x8A00;&#x4E2D;&#xFF0C;&#x7A7A;&#x63A5;&#x53E3;&#x53EF;&#x4EE5;&#x8868;&#x793A;&#x4EFB;&#x4F55;&#x7C7B;&#x578B;&#xFF0C;&#x5982;&#x679C;&#x51FD;&#x6570;&#x53C2;&#x6570;&#x4E3A;interface{}&#xFF0C;&#x7F16;&#x8BD1;&#x671F;&#x5F88;&#x96BE;&#x786E;&#x5B9A;&#x53C2;&#x6570;&#x7684;&#x5177;&#x4F53;&#x7C7B;&#x578B;&#xFF0C;&#x4E5F;&#x4F1A;&#x53D1;&#x751F;&#x9003;&#x9038;&#x3002;</p>
<h4 id="3&#x3001;&#x6808;&#x7A7A;&#x95F4;&#x4E0D;&#x8DB3;">3&#x3001;&#x6808;&#x7A7A;&#x95F4;&#x4E0D;&#x8DB3;</h4>
<p>&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x5BF9;&#x5185;&#x6838;&#x7EBF;&#x7A0B;&#x4F7F;&#x7528;&#x7684;&#x6808;&#x7A7A;&#x95F4;&#x5927;&#x5C0F;&#x662F;&#x6709;&#x9650;&#x5236;&#x7684;&#xFF0C;64&#x4F4D;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x901A;&#x5E38;&#x662F;8MB&#x3002;</p>
<p>&#x6808;&#x7A7A;&#x95F4;&#x901A;&#x5E38;&#x6BD4;&#x8F83;&#x5C0F;&#xFF0C;&#x56E0;&#x6B64;&#x9012;&#x5F52;&#x51FD;&#x6570;&#x5B9E;&#x73B0;&#x4E0D;&#x5F53;&#x65F6;&#xFF0C;&#x5BB9;&#x6613;&#x5BFC;&#x81F4;&#x6808;&#x6EA2;&#x51FA;&#x3002;</p>
<p>&#x5BF9;&#x4E8E;go&#x6765;&#x8BF4;&#xFF0C;&#x8FD0;&#x884C;&#x65F6;&#x5C1D;&#x8BD5;&#x5728;goroutine&#x9700;&#x8981;&#x7684;&#x65F6;&#x5019;&#x52A8;&#x6001;&#x7684;&#x5206;&#x914D;&#x6808;&#x7A7A;&#x95F4;&#xFF0C;goroutine&#x7684;&#x521D;&#x59CB;&#x6808;&#x5927;&#x5C0F;&#x4E3A;2KB&#xFF0C;&#x5F53;goroutine&#x88AB;&#x8C03;&#x5EA6;&#x65F6;&#xFF0C;&#x4F1A;&#x7ED1;&#x5B9A;&#x5185;&#x6838;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#xFF0C;&#x6808;&#x7A7A;&#x95F4;&#x5927;&#x5C0F;&#x4E5F;&#x4E0D;&#x4F1A;&#x8D85;&#x8FC7;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x9650;&#x5236;&#x3002;</p>
<p>&#x5BF9;&#x4E8E;go&#x7F16;&#x8BD1;&#x5668;&#x6765;&#x8BF4;&#xFF0C;&#x8D85;&#x8FC7;&#x4E00;&#x5B9A;&#x5927;&#x5C0F;&#x7684;&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#x5C06;&#x9003;&#x9038;&#x5230;&#x5806;&#x4E0A;&#xFF0C;&#x4E0D;&#x540C;&#x7684;go&#x7248;&#x672C;&#x7684;&#x5927;&#x5C0F;&#x9650;&#x5236;&#x53EF;&#x80FD;&#x4E0D;&#x4E00;&#x6837;&#x3002;</p>
<p>&#x7ECF;&#x9A8C;&#xFF1A;&#x6307;&#x9488;&#x6307;&#x5411;&#x7684;&#x6570;&#x636E;&#x90FD;&#x662F;&#x5728;&#x5806;&#x4E0A;&#x5206;&#x914D;&#x7684;</p>
<h3 id="&#x4E09;&#x3001;&#x67E5;&#x770B;&#x53D8;&#x91CF;&#x9003;&#x9038;&#x60C5;&#x51B5;">&#x4E09;&#x3001;&#x67E5;&#x770B;&#x53D8;&#x91CF;&#x9003;&#x9038;&#x60C5;&#x51B5;</h3>
<p>&#x7F16;&#x8BD1;&#x65F6;&#x53EF;&#x4EE5;&#x501F;&#x52A9;&#x9009;&#x9879;-gcflags=-m&#xFF0C;&#x67E5;&#x770B;&#x53D8;&#x91CF;&#x7684;&#x9003;&#x9038;&#x60C5;&#x51B5;</p>
<p>$ go build -gcflags=-m main_pointer.go 
./main_pointer.go:10:6: can inline createDemo
./main_pointer.go:17:20: inlining call to createDemo
./main_pointer.go:18:13: inlining call to fmt.Println
./main_pointer.go:10:17: leaking param: name
./main_pointer.go:11:10: new(Demo) escapes to heap
./main_pointer.go:17:20: new(Demo) escapes to heap
./main_pointer.go:18:13: demo escapes to heap
./main_pointer.go:18:13: main []interface {} literal does not escape
./main_pointer.go:18:13: io.Writer(os.Stdout) escapes to heap</p>
<p><autogenerated>:1: (*File).close .this does not escape</autogenerated></p>
<p>escape to heap &#x8868;&#x793A;&#x9003;&#x9038;&#x5230;&#x5806;&#x4E0A;</p>
<h3 id="&#x56DB;&#x3001;go-&#x9003;&#x9038;faq">&#x56DB;&#x3001;go &#x9003;&#x9038;FAQ</h3>
<p>How do I know whether a variable is allocated on the heap or the stack?</p>
<p>From a correctness standpoint, you don&apos;t need to know. Each variable in Go exists as long as there are references to it. The storage location chosen by the implementation is irrelevant to the semantics of the language.</p>
<p>The storage location does have an effect on writing efficient programs. When possible, the Go compilers will allocate variables that are local to a function in that function&apos;s stack frame. However, if the compiler cannot prove that the variable is not referenced after the function returns, then the compiler must allocate the variable on the garbage-collected heap to avoid dangling pointer errors. Also, if a local variable is very large, it might make more sense to store it on the heap rather than the stack.</p>
<p>In the current compilers, if a variable has its address taken, that variable is a candidate for allocation on the heap. However, a basic escape analysis recognizes some cases when such variables will not live past the return from the function and can reside on the stack.</p>
<p>&#x4E2D;&#x6587;&#xFF1A;</p>
<p>&#x6211;&#x5982;&#x4F55;&#x77E5;&#x9053;&#x53D8;&#x91CF;&#x662F;&#x5206;&#x914D;&#x5728;&#x5806;&#x4E0A;&#x8FD8;&#x662F;&#x6808;&#x4E0A;&#xFF1F;</p>
<p>&#x4ECE;&#x6B63;&#x786E;&#x6027;&#x7684;&#x89D2;&#x5EA6;&#x6765;&#x770B;&#xFF0C;&#x60A8;&#x4E0D;&#x9700;&#x8981;&#x77E5;&#x9053;&#x3002;&#x53EA;&#x8981;&#x6709;&#x5BF9;&#x5B83;&#x7684;&#x5F15;&#x7528;&#xFF0C;Go &#x4E2D;&#x7684;&#x6BCF;&#x4E2A;&#x53D8;&#x91CF;&#x5C31;&#x5B58;&#x5728;&#x3002;&#x5B9E;&#x73B0;&#x9009;&#x62E9;&#x7684;&#x5B58;&#x50A8;&#x4F4D;&#x7F6E;&#x4E0E;&#x8BED;&#x8A00;&#x7684;&#x8BED;&#x4E49;&#x65E0;&#x5173;&#x3002;</p>
<p>&#x5B58;&#x50A8;&#x4F4D;&#x7F6E;&#x786E;&#x5B9E;&#x5BF9;&#x7F16;&#x5199;&#x9AD8;&#x6548;&#x7A0B;&#x5E8F;&#x6709;&#x5F71;&#x54CD;&#x3002;&#x5982;&#x679C;&#x53EF;&#x80FD;&#xFF0C;Go &#x7F16;&#x8BD1;&#x5668;&#x5C06;&#x5728;&#x8BE5;&#x51FD;&#x6570;&#x7684;&#x5806;&#x6808;&#x5E27;&#x4E2D;&#x5206;&#x914D;&#x8BE5;&#x51FD;&#x6570;&#x7684;&#x672C;&#x5730;&#x53D8;&#x91CF;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x5982;&#x679C;&#x7F16;&#x8BD1;&#x5668;&#x5728;&#x51FD;&#x6570;&#x8FD4;&#x56DE;&#x540E;&#x65E0;&#x6CD5;&#x8BC1;&#x660E;&#x8BE5;&#x53D8;&#x91CF;&#x672A;&#x88AB;&#x5F15;&#x7528;&#xFF0C;&#x90A3;&#x4E48;&#x7F16;&#x8BD1;&#x5668;&#x5FC5;&#x987B;&#x5728;&#x5783;&#x573E;&#x56DE;&#x6536;&#x5806;&#x4E0A;&#x5206;&#x914D;&#x8BE5;&#x53D8;&#x91CF;&#x4EE5;&#x907F;&#x514D;&#x60AC;&#x7A7A;&#x6307;&#x9488;&#x9519;&#x8BEF;&#x3002;&#x6B64;&#x5916;&#xFF0C;&#x5982;&#x679C;&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#x975E;&#x5E38;&#x5927;&#xFF0C;&#x5C06;&#x5176;&#x5B58;&#x50A8;&#x5728;&#x5806;&#x4E0A;&#x800C;&#x4E0D;&#x662F;&#x6808;&#x4E0A;&#x53EF;&#x80FD;&#x66F4;&#x6709;&#x610F;&#x4E49;&#x3002;</p>
<p>&#x5728;&#x5F53;&#x524D;&#x7684;&#x7F16;&#x8BD1;&#x5668;&#x4E2D;&#xFF0C;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x53D8;&#x91CF;&#x7684;&#x5730;&#x5740;&#x88AB;&#x5360;&#x7528;&#xFF0C;&#x90A3;&#x4E48;&#x8BE5;&#x53D8;&#x91CF;&#x5C31;&#x662F;&#x5728;&#x5806;&#x4E0A;&#x5206;&#x914D;&#x7684;&#x5019;&#x9009;&#x8005;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x57FA;&#x672C;&#x7684;&#x9003;&#x9038;&#x5206;&#x6790;&#x4F1A;&#x8BC6;&#x522B;&#x67D0;&#x4E9B;&#x60C5;&#x51B5;&#xFF0C;&#x5373;&#x6B64;&#x7C7B;&#x53D8;&#x91CF;&#x4E0D;&#x4F1A;&#x8D85;&#x8FC7;&#x51FD;&#x6570;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x9A7B;&#x7559;&#x5728;&#x6808;&#x4E2D;&#x3002;</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="./" class="navigation navigation-prev " aria-label="Previous page: Go">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="go闭包.html" class="navigation navigation-next " aria-label="Next page: 闭包">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"内存逃逸","level":"1.2.1","depth":2,"next":{"title":"闭包","level":"1.2.2","depth":2,"path":"go/go闭包.md","ref":"go/go闭包.md","articles":[]},"previous":{"title":"Go","level":"1.2","depth":1,"path":"go/README.md","ref":"go/README.md","articles":[{"title":"内存逃逸","level":"1.2.1","depth":2,"path":"go/go 内存逃逸.md","ref":"go/go 内存逃逸.md","articles":[]},{"title":"闭包","level":"1.2.2","depth":2,"path":"go/go闭包.md","ref":"go/go闭包.md","articles":[]},{"title":"embed","level":"1.2.3","depth":2,"path":"go/go embed.md","ref":"go/go embed.md","articles":[]},{"title":"编译指令","level":"1.2.4","depth":2,"path":"go/编译指令.md","ref":"go/编译指令.md","articles":[]}]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["livereload"],"pluginsConfig":{"livereload":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"go/go 内存逃逸.md","mtime":"2023-05-11T03:20:23.529Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2023-05-11T05:54:13.896Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

