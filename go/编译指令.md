# 编译指令

## 1、//go:nosplit

goroutine的栈可以动态自增，Runtime会追踪每个stack的使用情况。在运行函数之前会进行检查以确保有足够的栈空间来运行该函数，如果不够，代码会先进入runtime扩充stack。

但是有时候这种开销是不可接受的（偶尔也不安全）。

//go:nosplit指令禁止栈拆分，会导致一个问题，如果堆栈耗尽，编译器必须确保运行函数是安全的，不能因为避免了栈检查的开销就让函数使用比被允许的空间更多的内存。这样做会破坏其他goroutine的内存空间。

为此，编译器维护一个名为redzone的缓冲区，一个768字节的，分配在每个goroutines的堆栈框架底部，保证可用。

编译器会跟踪每个函数的堆栈要求。当它遇到一个nosplit函数时，它会累积该函数对redzone的堆栈分配。通过这种方式，nosplit函数可以对redzone缓冲区执行，同时避免在不方便的时候堆栈增长。

## 2、//go:noescape

这个指令告诉编译器，下面的func没有任何参数escape，编译器会跳过对func参数的检查

## 3、//go:norace

这个指令可以使编译器跳过竞争检测

## 4、//go:inline

这个指令告诉编译器不要inline
